

// ========================================
// COMMUNITY & MESSAGING MODELS
// ========================================

model Community {
  id          String   @id @default(cuid())
  name        String
  description String?
  creatorId   String
  creator     User     @relation("CommunityCreator", fields: [creatorId], references: [id], onDelete: Cascade)
  isPrivate   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  members CommunityMember[]
  posts   CommunityPost[]

  @@index([creatorId])
}

model CommunityMember {
  id          String   @id @default(cuid())
  communityId String
  community   Community @relation(fields: [communityId], references: [id], onDelete: Cascade)
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  role        String    @default("MEMBER") // ADMIN, MODERATOR, MEMBER
  joinedAt    DateTime  @default(now())

  @@unique([communityId, userId])
  @@index([userId])
}

model CommunityPost {
  id          String    @id @default(cuid())
  communityId String
  community   Community @relation(fields: [communityId], references: [id], onDelete: Cascade)
  authorId    String
  author      User      @relation(fields: [authorId], references: [id], onDelete: Cascade)
  content     String    @db.Text
  isPinned    Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  replies CommunityPostReply[]

 @@index([communityId, createdAt])
  @@index([authorId])
}

model CommunityPostReply {
  id        String        @id @default(cuid())
  postId    String
  post      CommunityPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  authorId  String
  author    User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
  content   String        @db.Text
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@index([postId, createdAt])
  @@index([authorId])
}

model DirectMessage {
  id         String   @id @default(cuid())
  senderId   String
  sender     User     @relation("MessagesSent", fields: [senderId], references: [id], onDelete: Cascade)
  receiverId String
  receiver   User     @relation("MessagesReceived", fields: [receiverId], references: [id], onDelete: Cascade)
  content    String   @db.Text
  isRead     Boolean  @default(false)
  createdAt  DateTime @default(now())

  @@index([senderId, receiverId, createdAt])
  @@index([receiverId, isRead])
}
